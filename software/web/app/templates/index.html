<!DOCTYPE HTML>
    <head>
        <title>{{ title }}</title>
        <link rel="stylesheet" href="../static/assets/css/style.css">
    </head>
    <body>
        <main id="main">
            <header id="header" class="header">
                <div class="container">
                    <img src="../static/assets/img/GROUND_INFRASTRUCTURE.png" alt="GURGI_logo" width="50" height="50">
                    <h1 id="title">GU Rocketry Weather Station mk1</h1>
                </div>
            </header>

            <div id="timebox">
                <h2 id="datetime">Last updated: {{ time }}</h2>
            </div>

            <div id="content" class="flex-container">
                <div id="databox" class="flex-item">
                    <h2 id="datatitle">Current conditions:</h2>
                    <ul>
                        <li id="temp">Temperature: {{ temp }} &#176;C</li>
                        <li id="pressure">Pressure: {{ pressure }} bar</li>
                        <li id="humidity">Humidity: {{ humid }}%</li>  
                        <li id="windspeed">Wind speed: {{ wind_v }} m/s</li>
                        <li id="windvector">Wind direction: {{ wind_d }} &#176;</li>
                        <li id="rainfall">4-hour Rainfall: {{ rain }} mm</li>
                    </ul>
                </div>
            </div>

            <div id="timebox">
                <h3 id="updates">Total updates since start: {{ updates }} </h3>
                <h3 id="gps">GPS Coordinates: {{ coords }}</h3>
                <h3><a href="https://github.com/andrewsg3/gurgi_ws1" target="blank">Link to GitHub</a></h3>
            </div>

            <div>
                <div>
                    <div id="data-container">

                    </div>
                </div>
            </div>

            <div class="container">
                <div class="row">
                    <div class="col-lg-8  offset-lg-2">
                        <h3 class="mt-5">Live Streaming</h3>
                        <img src="{{ url_for('video_feed') }}" width="100%">
                    </div>
                </div>
            </div>

            <footer id="footer">
                The Mobile Weather Station is a product of the GUR Ground Infrastructure Team.<br>
                Contact Electronics Team lead Andrew Scott-George for usage information or to report a bug.<br>
                Copyright 2019-2021 by Glasgow University Rocketry. All Rights Reserved.
            </footer>
        </main>

        <script>
            //Room for script here
        </script>


    </body>

    <script>
        //Type as javascript
        setInterval(function () {
            console.log("Hello"); // Log console; debug
            
            var opts = { // A set of parameters passed to the fetch function.
                method: 'GET',      
                headers: {}
                };

            //fetch function calls a path from app.py: in this case, /update.
            fetch('/update', opts).then(function (response) { //.then takes the output of the last thing you said and uses it as the input to the next thing you say. This is called "piping"
            // So basically we format the output of the /update path in json format?
                return response.json();
                })

            .then(function (body) { // Here, we declare a function that takes our formatted data from /update and calls it "body"
                console.log(body) // Print to console the contents of body for debugging purposes. To see this, go to the webapp on a browser, right click and press inspect. Then look at console.
                document.getElementById('temp').innerHTML = 'Temperature: '+ body.temperature +" &#176;C" // Find elements by their ID and update them to a value taken from "body", which was the output of the fetch function.
                document.getElementById('pressure').innerHTML = 'Pressure: ' + body.pressure + " bar" 
                document.getElementById('humidity').innerHTML = 'Humidity: ' + body.humidity + " %" 
                document.getElementById('windspeed').innerHTML = 'Wind speed: ' + body.windspeed + " m/s" 
                document.getElementById('windvector').innerHTML = 'Wind direction: ' + body.windvector + " &#176;"
                document.getElementById('rainfall').innerHTML = '4-Hour Rainfall: ' + body.rainfall + " mm"; 
                document.getElementById('updates').innerHTML = 'Total updates since start: ' + body.updates
                document.getElementById('datetime').innerHTML = 'Last updated: ' + body.datetime,
                document.getElemetnyById('coords').innerHTML = 'GPS Coordinates: ' + body.coords

            });
        }, 500); // Last param is time in ms, here it's set to 1s.

        // Plotting with d3
        //https://www.freecodecamp.org/learn/data-visualization/data-visualization-with-d3/dynamically-change-the-height-of-each-bar
    </script>
</html>